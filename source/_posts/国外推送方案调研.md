---
title: 国外推送方案的调研
---
 
 解决的问题:国外推送无法推送到指定的手机
 问题的原因:由于在国内GFW原因,国内网络推送无法到达。目前采用的Umeng推送方案存在到达率问题。

 对现有主流的推送方案进行评估:
 (一)友盟推送:
 (1)原理:
 Umeng的推送机制是采用独立进程运行，兄弟App共享长连接方式。【手机中采用Umeng推送的APP可以共享Service】收取推送。

 (2)存在的问题:
 1.国外用户收不到推送:实际查看Umeng后台分析，发现国外用户推送到达率不高。可能由于Umeng服务器未覆盖到一些国家和相应的地区引起的原因。
 2.相关的测试结果来看，部分手机由于系统问题导致Service存活率情况不高。
 3.在service被杀死后有一定概率丢失消息,有一定延时率。

 (二)小米推送:
 之前在确定需求时，有提出第三世界的国家，例如:印度，他可能购买了中国的手机比如小米手机，还有一个情况：国产手机在国外使用的情况【Umeng解决】
 (1)原理:采用系统长连接方式推送。只要系统不死，可以保证90%的推送到达率,原生和MIUI系统上有良好的存活率。
 (2)此方案使用时候，需要看小米用户的数量来决定是否采用。

 (三)Google原生服务GCM【现已升级为FCM】
 (1)原理:App服务器向GCM连接服务器发送HTTP/XMPP请求，GCM存储相关推送信息，并通过一个Token作为表示，并向注册了GCM服务的客户端推送特定消息。
 (2)存在问题：FCM服务必须是在安装了googleplayServer才能正常运行。

 综上分析:采用Umeng和Google FCM作为方案。针对国外的渠道，采用FCM推送，国内的渠道，采用Umeng推送。

 有一个基于FCM的方案OneSignal[https://documentation.onesignal.com] 他提供了一个管理后台，对APP对达到率,推送的延迟率，用户量等的数据统计服务。
 根据实际需求:后台单独会做相关的数据统计，所以不考虑此方案。
 需要思考的几个问题:
 1.FCM是否可以进行群推【查看相应的API】
 2.需要对推送的方案进行单独模块划分并配置
 3.客户端原先旧版升级到新版推送方案切换的问题。


 客户端需要评估方案的集成：
 1.将推送部分分模块进行集成:其中涉及到，各个不同的模块对进行推送相关操作时候，需要添加相关的权限。单独在AndroidManifest.xml中配置会导致权限混乱。
  添加相关的权限时候，指定渠道名称，通过代码动态写入的方式。
 2.当然采用两种推送方案的时候，需要写一个管理类PushManager对推送方案进行判断:国外的手机并且安装了google play server的手机采用FCM的推送方式 



 






